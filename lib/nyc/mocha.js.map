{"version":3,"sources":["../../src/nyc/mocha.js"],"names":["runMocha","runner","restart","grepRegExp","mochaRunner","file","note","abort","mocha","grep","require","cache","addFile","run","RegExp","warn"],"mappings":";;;;;kBAkCwBA,Q;;AAlCxB;;;;AACA;;;;;;AAEA,IAAIC,MAAJ;AACA,IAAIC,OAAJ;AACA,IAAIC,UAAJ;;AAEA,SAASC,WAAT,CAAqBC,IAArB,EAA2B;AACvB,QAAIJ,MAAJ,EAAY;AACR,wBAAIK,IAAJ,CAAS,8CAAT;AACAJ,kBAAUG,IAAV;AACAJ,eAAOM,KAAP;AACH,KAJD,MAIO;AACHL,kBAAU,IAAV;AACA,cAAMM,QAAQ,qBAAd;;AAEA,YAAIL,UAAJ,EAAgB;AACZK,kBAAMC,IAAN,CAAWN,UAAX;AACH;;AAED,eAAOO,QAAQC,KAAR,CAAcN,IAAd,CAAP;;AAEAG,cAAMI,OAAN,CAAcP,IAAd;;AAEAJ,iBAASO,MAAMK,GAAN,CAAU,MAAM;AACrBZ,qBAAS,IAAT;;AAEA,gBAAIC,OAAJ,EAAa;AACTE,4BAAYF,OAAZ;AACH;AACJ,SANQ,CAAT;AAOH;AACJ;;AAEc,SAASF,QAAT,CAAkBS,IAAlB,EAAwB;AACnC;AACA;AACAC,YAAQ,6BAAR;;AAEA,QAAID,IAAJ,EAAU;AACNN,qBAAa,IAAIW,MAAJ,CAAWL,IAAX,CAAb;AACH;;AAED,WAAO;AACHF,eAAO,MAAM;AACT,gBAAIN,MAAJ,EAAY;AACR,gCAAIc,IAAJ,CAAS,6BAAT;AACAd,uBAAOM,KAAP;AACH;AACJ,SANE;AAOHM,aAAKT;AAPF,KAAP;AASH","file":"mocha.js","sourcesContent":["import Mocha from 'mocha';\nimport log from 'roc/log/default/small';\n\nlet runner;\nlet restart;\nlet grepRegExp;\n\nfunction mochaRunner(file) {\n    if (runner) {\n        log.note('\\nAborting current tests and will restart.\\n');\n        restart = file;\n        runner.abort();\n    } else {\n        restart = null;\n        const mocha = new Mocha();\n\n        if (grepRegExp) {\n            mocha.grep(grepRegExp);\n        }\n\n        delete require.cache[file];\n\n        mocha.addFile(file);\n\n        runner = mocha.run(() => {\n            runner = null;\n\n            if (restart) {\n                mochaRunner(restart);\n            }\n        });\n    }\n}\n\nexport default function runMocha(grep) {\n    // Enable source map support\n    // eslint-disable-next-line\n    require('source-map-support/register');\n\n    if (grep) {\n        grepRegExp = new RegExp(grep);\n    }\n\n    return {\n        abort: () => {\n            if (runner) {\n                log.warn('\\nAborting current tests.\\n');\n                runner.abort();\n            }\n        },\n        run: mochaRunner,\n    };\n}\n"]}